"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.verifyTokenAndAuthorization=exports.verifyTokenAndAdmin=exports.verifyToken=void 0;var jwt=_interopRequireWildcard(require("jsonwebtoken"));function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function(e){return e?t:r})(e)}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}const verifyToken=(e,r,t)=>{const n=process.env.JWT_SEC,o=e.headers.authorization;if(!o)return r.status(401).json("Not authorized");{const i=o.split(" ")[1];jwt.verify(i,n,(async(n,o)=>n?(console.log(n),r.status(403).json("Token not valid")):o?(o&&(e.user=o),void t()):r.status(400).json({error:"Not authorized"})))}};exports.verifyToken=verifyToken;const verifyTokenAndAuthorization=(e,r,t)=>{verifyToken(e,r,(()=>{e.user&&(e.user.id===e.params.id||e.user.is_admin?t():r.status(403).json("Sie sind nicht fÃ¼r diese Operation authorisiert"))}))};exports.verifyTokenAndAuthorization=verifyTokenAndAuthorization;const verifyTokenAndAdmin=(e,r,t)=>{verifyToken(e,r,(()=>{e.user&&(e.user.is_admin?t():r.status(403).json("Not authorized"))}))};exports.verifyTokenAndAdmin=verifyTokenAndAdmin;