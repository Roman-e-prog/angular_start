"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SingleQuestionComponent=void 0;var _dec,_class,_core=require("@angular/core"),_forum=require("../../store/selectors/forum.selectors"),_rxjs=require("rxjs"),_forum2=require("../../store/actions/forum.actions"),_common=require("@angular/common"),_forumAnswers=require("../../store/selectors/forumAnswers.selector"),_forumAnswers2=require("../../store/actions/forumAnswers.actions"),_answerModule=require("../../components/answer-module/answer-module.component"),_core2=require("@ng-icons/core"),_editForumQuestion=require("../../components/edit-forum-question/edit-forum-question.component"),_forumAnswerEditModule=require("../../components/forum-answer-edit-module/forum-answer-edit-module.component");let SingleQuestionComponent=exports.SingleQuestionComponent=(_dec=(0,_core.Component)({selector:"app-single-question",standalone:!0,imports:[_common.CommonModule,_answerModule.AnswerModuleComponent,_core2.NgIconsModule,_editForumQuestion.EditForumQuestionComponent,_forumAnswerEditModule.ForumAnswerEditModuleComponent],templateUrl: '../../html/app/pages/single-question.component.html',styleUrl: '../../css/app/pages/single-question.component.css'}))(_class=class{constructor(s,e,t,i,r,o,n){this.store=s,this.router=e,this.toastr=t,this.authService=i,this.httpClient=r,this.location=o,this.htmlStripService=n,this.user=this.authService.getUser(),this.answerModule=!1,this.singleForum$=this.store.select(_forum.selectForumData),this.isLoading$=this.store.select(_forum.selectForumLoading),this.isError$=this.store.select(_forum.selectForumError),this.message$=this.store.select(_forum.selectForumMessage),this.id=this.router.snapshot.paramMap.get("id"),this.getUserId=this.singleForum$.pipe((0,_rxjs.map)((s=>s.user_id))),this.forumUserId=this.getUserId.subscribe(),this.allAnswersToQuestion$=this.store.select(_forumAnswers.selectAllAnswerToQuestion),this.isAnswerLoading$=this.store.select(_forumAnswers.selectForumAnswerLoading),this.isAnswerError$=this.store.select(_forumAnswers.selectForumAnswerError),this.messageAnswer$=this.store.select(_forumAnswers.selectForumAnswerMessage),this.handleLikes=(s,e,t,i)=>{!this.user||this.user.id===e||t&&t.length&&t.some((s=>s===this.user.id))||i&&i.length&&i.some((s=>s===this.user.id))||(this.httpClient.post("http://localhost:5000/api/forum/likes",{id:s,user_id:this.user.id}).subscribe({next:s=>{console.log(s)}}),this.httpClient.get(`http://localhost:5000/api/forum/find/${s}`).subscribe())},this.handleDislikes=(s,e,t,i)=>{!this.user||this.user.id===e||t&&t.length&&t.some((s=>s===this.user.id))||i&&i.length&&i.some((s=>s===this.user.id))||(this.httpClient.post("http://localhost:5000/api/forum/dislikes",{id:s,user_id:this.user.id}).subscribe({next:s=>{console.log(s)}}),this.httpClient.get(`http://localhost:5000/api/forum/find/${s}`).subscribe())},this.handleAnswerLikes=(s,e,t,i)=>{!this.user||this.user.id===e||t&&t.length&&t.some((s=>s===this.user.id))||i&&i.length&&i.some((s=>s===this.user.id))||(this.httpClient.post("http://localhost:5000/api/forumAnswers/likes",{id:s,user_id:this.user.id}).subscribe({next:s=>{console.log(s)}}),this.httpClient.get(`http://localhost:5000/api/forumAnswers/find/${s}`).subscribe())},this.handleAnswerDislikes=(s,e,t,i)=>{!this.user||this.user.id===e||t&&t.length&&t.some((s=>s===this.user.id))||i&&i.length&&i.some((s=>s===this.user.id))||(this.httpClient.post("http://localhost:5000/api/forumAnswers/dislikes",{id:s,user_id:this.user.id}).subscribe({next:s=>{console.log(s)}}),this.httpClient.get(`http://localhost:5000/api/forumAnswers/find/${s}`).subscribe())},this.handleHasSolved=(s,e)=>{this.user.id===this.forumUserId&&(this.httpClient.post("http://localhost:5000/api/forumAnswers/hasSolved",{id:s,question_id:e}).subscribe({next:s=>{console.log(s)}}),this.httpClient.get(`http://localhost:5000/api/forumAnswers/find/${s}`).subscribe())},this.handleAnswerClose=()=>{this.answerModule=!1},this.answerData=null,this.handleReply=s=>{this.answerModule=!0,this.answerData={username:this.user.username,user_id:this.user.id,is_admin:this.user.is_admin,question_id:s,answerername:"",answerer_id:0}},this.handleAnswerReply=(s,e,t)=>{this.answerModule=!0,this.answerData={username:e,user_id:t,is_admin:this.user.is_admin,question_id:s,answerername:this.user.username,answerer_id:this.user.id}},this.goBack=()=>{this.location.back()},this.handleQuestionDelete=s=>{this.store.dispatch((0,_forum2.deleteForum)({id:s}))},this.editForumModule=!1,this.editQuestionData=null,this.handleClose=()=>{this.editForumModule=!1},this.handleQuestionEdit=s=>{this.editForumModule=!0,this.editQuestionData=s},this.handleAnswerDelete=s=>{this.store.dispatch((0,_forumAnswers2.deleteForumAnswer)({id:s}))},this.editAnswerModule=!1,this.editAnswerData=null,this.handleAnswerEditClose=()=>{this.editAnswerModule=!1},this.handleAnswerEdit=s=>{this.editAnswerModule=!0,this.editAnswerData=s}}ngOnInit(){this.id&&(this.store.dispatch((0,_forum2.getForum)({id:parseInt(this.id)})),this.store.dispatch((0,_forumAnswers2.getAllAnswersToQuestion)({id:parseInt(this.id)}))),(0,_rxjs.combineLatest)([this.isError$,this.isAnswerError$]).subscribe((([s,e])=>{s&&this.message$.subscribe((s=>{this.toastr.error(s)})),e&&this.messageAnswer$.subscribe((s=>{this.toastr.error(s)}))}))}getProcessedContent(s){return s?this.htmlStripService.stripHtml(s).trim():""}})||_class;