"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SingleQuestionComponent=void 0;var _dec,_class,_core=require("@angular/core"),_forum=require("../../store/selectors/forum.selectors"),_rxjs=require("rxjs"),_forum2=require("../../store/actions/forum.actions"),_common=require("@angular/common"),_forumAnswers=require("../../store/selectors/forumAnswers.selector"),_forumAnswers2=require("../../store/actions/forumAnswers.actions"),_answerModule=require("../../components/answer-module/answer-module.component"),_core2=require("@ng-icons/core"),_editForumQuestion=require("../../components/edit-forum-question/edit-forum-question.component"),_forumAnswerEditModule=require("../../components/forum-answer-edit-module/forum-answer-edit-module.component");let SingleQuestionComponent=exports.SingleQuestionComponent=(_dec=(0,_core.Component)({selector:"app-single-question",standalone:!0,imports:[_common.CommonModule,_answerModule.AnswerModuleComponent,_core2.NgIconsModule,_editForumQuestion.EditForumQuestionComponent,_forumAnswerEditModule.ForumAnswerEditModuleComponent],templateUrl: '../../html/app/pages/single-question.component.html',styleUrl: '../../css/app/pages/single-question.component.css'}))(_class=class{constructor(e,s,t,r,i,o,n,u){this.store=e,this.router=s,this.toastr=t,this.authService=r,this.location=i,this.htmlStripService=o,this.cdr=n,this.platformId=u,this.user=this.authService.getUser(),this.answerModule=!1,this.id=this.router.snapshot.paramMap.get("id"),this.singleForum$=this.store.select(_forum.selectForumData),this.isLoading$=this.store.select(_forum.selectForumLoading),this.isError$=this.store.select(_forum.selectForumError),this.message$=this.store.select(_forum.selectForumMessage),this.forumUserId=void 0,this.allAnswersToQuestion$=this.store.select(_forumAnswers.selectAllAnswerToQuestion),this.isAnswerLoading$=this.store.select(_forumAnswers.selectForumAnswerLoading),this.isAnswerError$=this.store.select(_forumAnswers.selectForumAnswerError),this.messageAnswer$=this.store.select(_forumAnswers.selectForumAnswerMessage),this.handleLikes=(e,s,t,r)=>{!this.user||this.user.id===s||t&&t.length&&t.some((e=>e===this.user.id))||r&&r.length&&r.some((e=>e===this.user.id))||this.store.dispatch((0,_forum2.incrementLikes)({id:e,user_id:this.user.id}))},this.handleDislikes=(e,s,t,r)=>{!this.user||this.user.id===s||t&&t.length&&t.some((e=>e===this.user.id))||r&&r.length&&r.some((e=>e===this.user.id))||this.store.dispatch((0,_forum2.incrementDisLikes)({id:e,user_id:this.user.id}))},this.handleAnswerLikes=(e,s,t,r)=>{!this.user||this.user.id===s||t&&t.length&&t.some((e=>e===this.user.id))||r&&r.length&&r.some((e=>e===this.user.id))||this.store.dispatch((0,_forumAnswers2.incrementAnswerLikes)({id:e,user_id:this.user.id}))},this.handleAnswerDislikes=(e,s,t,r)=>{!this.user||this.user.id===s||t&&t.length&&t.some((e=>e===this.user.id))||r&&r.length&&r.some((e=>e===this.user.id))||(this.user.id?this.store.dispatch((0,_forumAnswers2.incrementAnswerDisLikes)({id:e,user_id:this.user.id})):console.error("User ID is undefined, action aborted"))},this.handleHasSolved=(e,s)=>{this.user.id===this.forumUserId&&(this.store.dispatch((0,_forumAnswers2.hasSolved)({id:e,question_id:s})),this.store.dispatch((0,_forum2.getForum)({id:e})),this.store.dispatch((0,_forumAnswers2.getAllAnswersToQuestion)({id:e})))},this.handleAnswerClose=()=>{this.answerModule=!1},this.answerData=null,this.handleReply=e=>{this.answerModule=!0,this.answerData={username:this.user.username,user_id:this.user.id,is_admin:this.user.is_admin,question_id:e,answerername:"",answerer_id:0}},this.handleAnswerReply=(e,s,t)=>{this.answerModule=!0,this.answerData={username:s,user_id:t,is_admin:this.user.is_admin,question_id:e,answerername:this.user.username,answerer_id:this.user.id}},this.goBack=()=>{this.location.back()},this.handleQuestionDelete=e=>{this.store.dispatch((0,_forum2.deleteForum)({id:e}))},this.editForumModule=!1,this.editQuestionData=null,this.handleClose=()=>{this.editForumModule=!1},this.handleQuestionEdit=e=>{this.editForumModule=!0,this.editQuestionData=e},this.handleAnswerDelete=(e,s)=>{this.store.dispatch((0,_forumAnswers2.deleteForumAnswer)({id:e,question_id:s}))},this.editAnswerModule=!1,this.editAnswerData=null,this.handleAnswerEditClose=()=>{this.editAnswerModule=!1},this.handleAnswerEdit=e=>{this.editAnswerModule=!0,this.editAnswerData=e}}ngOnInit(){(0,_rxjs.combineLatest)([this.isError$,this.isAnswerError$]).subscribe((([e,s])=>{e&&this.message$.subscribe((e=>{this.toastr.error(e)})),s&&this.messageAnswer$.subscribe((e=>{this.toastr.error(e)}))})),this.store.dispatch((0,_forum2.getForum)({id:parseInt(this.id)})),this.singleForum$.pipe((0,_rxjs.filter)((e=>!!e)),(0,_rxjs.map)((e=>e.user_id)),(0,_rxjs.distinctUntilChanged)()).subscribe({next:e=>{this.forumUserId=e},error:e=>{console.error("Error fetching forum user_id:",e)}})}getProcessedContent(e){return e?this.htmlStripService.stripHtml(e).trim():""}})||_class;