"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ForumAnswerEffect=void 0;var _dec,_class,_core=require("@angular/core"),_effects=require("@ngrx/effects"),_environment=require("../../environments/environment"),_forumAnswers=require("../actions/forumAnswers.actions"),_rxjs=require("rxjs"),_forum=require("../actions/forum.actions");let ForumAnswerEffect=exports.ForumAnswerEffect=(_dec=(0,_core.Injectable)())(_class=class{constructor(e,r,s){this.store=e,this.actions$=r,this.httpClient=s,this.api_url=`${_environment.environment.apiURL}api/forumAnswers/`,this.createForumAnswer$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forumAnswers.createForumAnswer),(0,_rxjs.mergeMap)((e=>this.httpClient.post(this.api_url,e.forumAnswerData).pipe((0,_rxjs.map)((r=>(this.store.dispatch((0,_forumAnswers.getAllAnswersToQuestion)({id:e.forumAnswerData.question_id})),(0,_forumAnswers.createForumAnswerSuccess)({forumAnswerData:r})))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forumAnswers.createForumAnswerError)({error:e})))))))))),this.updateForumAnswer$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forumAnswers.updateForumAnswer),(0,_rxjs.mergeMap)((e=>this.httpClient.put(this.api_url+e.id,e.forumAnswerData).pipe((0,_rxjs.map)((r=>(this.store.dispatch((0,_forumAnswers.getAllAnswersToQuestion)({id:e.forumAnswerData.question_id})),(0,_forumAnswers.updateForumAnswerSuccess)({forumAnswerData:r})))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forumAnswers.updateForumAnswerError)({error:e})))))))))),this.deleteForumAnswer$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forumAnswers.deleteForumAnswer),(0,_rxjs.mergeMap)((e=>this.httpClient.delete(this.api_url+e.id).pipe((0,_rxjs.map)((r=>(this.store.dispatch((0,_forumAnswers.getAllAnswersToQuestion)({id:e.question_id})),(0,_forumAnswers.deleteForumAnswerSuccess)({id:e.id})))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forumAnswers.deleteForumAnswerError)({error:e})))))))))),this.getForumAnswer$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forumAnswers.getForumAnswer),(0,_rxjs.mergeMap)((e=>this.httpClient.get(this.api_url+"find/"+e.id).pipe((0,_rxjs.map)((e=>(0,_forumAnswers.getForumAnswerSuccess)({forumAnswerData:e}))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forumAnswers.getForumAnswerError)({error:e})))))))))),this.getAllAnswersToQuestion$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forum.getForumSuccess),(0,_rxjs.mergeMap)((({forumData:e})=>{const r=e.id;return this.httpClient.get(this.api_url+"findAllAnswersToQuestion/"+r).pipe((0,_rxjs.map)((e=>(0,_forumAnswers.getAllAnswersToQuestionSuccess)({forumAnswerData:e}))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forumAnswers.getAllAnswersToQuestionError)({error:e})))))}))))),this.incrementAnswerLikes$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forumAnswers.incrementAnswerLikes),(0,_rxjs.mergeMap)((({id:e,user_id:r})=>this.httpClient.post(this.api_url+"likes",{id:e,user_id:r}).pipe((0,_rxjs.map)((e=>(0,_forumAnswers.incrementAnswerLikesSuccess)({id:e.id,likes:e.likes}))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forumAnswers.incrementAnswerLikesError)({error:e})))))))))),this.incrementAnswerDislikes$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forumAnswers.incrementAnswerDisLikes),(0,_rxjs.mergeMap)((({id:e,user_id:r})=>this.httpClient.post(this.api_url+"dislikes",{id:e,user_id:r}).pipe((0,_rxjs.map)((e=>(0,_forumAnswers.incrementAnswerDisLikesSuccess)({id:e.id,dislikes:e.dislikes}))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forumAnswers.incrementAnswerDisLikesError)({error:e})))))))))),this.hasSolved$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forumAnswers.hasSolved),(0,_rxjs.mergeMap)((({id:e,question_id:r})=>this.httpClient.post(this.api_url+"hasSolved",{id:e,question_id:r}).pipe((0,_rxjs.map)((r=>(0,_forumAnswers.hasSolvedSuccess)({id:e,has_solved:!0}))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forumAnswers.hasSolvedError)({error:e}))))))))))}})||_class;