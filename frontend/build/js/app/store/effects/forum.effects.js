"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ForumEffect=void 0;var _dec,_class,_core=require("@angular/core"),_effects=require("@ngrx/effects"),_environment=require("../../environments/environment"),_forum=require("../actions/forum.actions"),_rxjs=require("rxjs"),_forumAnswers=require("../actions/forumAnswers.actions");let ForumEffect=exports.ForumEffect=(_dec=(0,_core.Injectable)())(_class=class{constructor(e,r,t){this.store=e,this.actions$=r,this.httpClient=t,this.api_url=`${_environment.environment.apiURL}api/forum/`,this.createForum$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forum.createForum),(0,_rxjs.mergeMap)((e=>this.httpClient.post(this.api_url,e.forumData).pipe((0,_rxjs.map)((e=>(this.store.dispatch((0,_forum.getAllForum)()),(0,_forum.createForumSuccess)({forumData:e})))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forum.createForumError)({error:e})))))))))),this.updateForum$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forum.updateForum),(0,_rxjs.mergeMap)((e=>this.httpClient.put(this.api_url+e.id,e.forumData).pipe((0,_rxjs.map)((r=>(this.store.dispatch((0,_forum.getAllForum)()),this.store.dispatch((0,_forum.getForum)({id:e.id})),(0,_forum.updateForumSuccess)({forumData:r})))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forum.updateForumError)({error:e})))))))))),this.deleteForum$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forum.deleteForum),(0,_rxjs.mergeMap)((e=>this.httpClient.delete(this.api_url+e.id).pipe((0,_rxjs.map)((r=>(this.store.dispatch((0,_forum.getAllForum)()),(0,_forum.deleteForumSuccess)({id:e.id})))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forum.deleteForumError)({error:e})))))))))),this.getForum$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forum.getForum),(0,_rxjs.mergeMap)((({id:e})=>this.httpClient.get(this.api_url+"find/"+e).pipe((0,_rxjs.map)((e=>(0,_forum.getForumSuccess)({forumData:e}))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forum.getForumError)({error:e})))))))))),this.getAllForum$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forum.getAllForum),(0,_rxjs.mergeMap)((e=>this.httpClient.get(this.api_url+"find/").pipe((0,_rxjs.map)((e=>(0,_forum.getAllForumSuccess)({data:e}))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forum.getAllForumError)({error:e})))))))))),this.getAllUserQuestions$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forum.getAllUserQuestions),(0,_rxjs.mergeMap)((e=>this.httpClient.get(this.api_url+"allUserQuestions/"+e.id).pipe((0,_rxjs.map)((e=>(0,_forum.getAllUserQuestionsSuccess)({data:e}))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forum.getAllUserQuestionsError)(e)))))))))),this.incrementLikes$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forum.incrementLikes),(0,_rxjs.mergeMap)((({id:e,user_id:r})=>this.httpClient.post(this.api_url+"likes",{id:e,user_id:r}).pipe((0,_rxjs.map)((r=>(this.store.dispatch((0,_forum.getForum)({id:e})),(0,_forum.incrementLikesSuccess)()))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forum.incrementLikesError)(e)))))))))),this.incrementDisLikes$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forum.incrementDisLikes),(0,_rxjs.mergeMap)((({id:e,user_id:r})=>this.httpClient.post(this.api_url+"dislikes",{id:e,user_id:r}).pipe((0,_rxjs.map)((r=>(this.store.dispatch((0,_forum.getForum)({id:e})),(0,_forum.incrementDisLikesSuccess)()))),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forum.incrementDisLikesError)(e)))))))))),this.incrementViews$=(0,_effects.createEffect)((()=>this.actions$.pipe((0,_effects.ofType)(_forumAnswers.getAllAnswersToQuestionSuccess,_forum.getForumSuccess),(0,_rxjs.mergeMap)((e=>{let r,t;if("forumAnswerData"in e?t=e.forumAnswerData?.[0]?.question_id:r=e.forumData.id,!t&&!r)return(0,_rxjs.of)((0,_forum.incrementViewsError)({error:"No valid ID found for incrementing views"}));const s=r;return this.httpClient.post(this.api_url+"views",{id:s}).pipe((0,_rxjs.map)((()=>(0,_forum.incrementViewsSuccess)())),(0,_rxjs.catchError)((e=>(0,_rxjs.of)((0,_forum.incrementViewsError)({error:e})))))})))))}})||_class;