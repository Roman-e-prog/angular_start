"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.JwtInterceptor=void 0;var _dec,_class,_core=require("@angular/core"),_operators=require("rxjs/operators"),_jwtDecode=require("jwt-decode"),_rxjs=require("rxjs");let JwtInterceptor=exports.JwtInterceptor=(_dec=(0,_core.Injectable)({providedIn:"root"}))(_class=class{constructor(e,r,t,s,o,i){this.authService=e,this.httpClient=r,this.router=t,this.toastr=s,this.navlinksService=o,this.forumLinksService=i}intercept(e,r){const t=this.authService.getUser(),s=t?t.accessToken:null;if(s){const o=(0,_jwtDecode.jwtDecode)(s);if(!(!o||!o.exp)&&o.exp<Date.now()/1e3)return this.authService.refreshToken().pipe((0,_operators.switchMap)((s=>(t.accessToken=s,localStorage.setItem("user",JSON.stringify(t)),e=e.clone({setHeaders:{Authorization:`Bearer ${s}`}}),this.navlinksService.getNavlinks(),this.forumLinksService.getForumLinks(),r.handle(e)))),(0,_operators.catchError)((e=>(this.toastr.error("Ein Fehler ist aufgetreten, bitte melden Sie sich neu an"),this.authService.logout(),this.router.navigate(["/login"]),(0,_rxjs.throwError)((()=>e))))));e=e.clone({setHeaders:{Authorization:`Bearer ${s}`}})}return r.handle(e)}})||_class;